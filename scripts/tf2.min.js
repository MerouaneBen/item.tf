var HoverBox,Item,ItemBox,User,ajax,capitalize,escapeHTML,getCookie,postAjax,priceSources,root,setCookie,_getAjaxRequest,__indexOf=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1},__bind=function(n,t){return function(){return n.apply(t,arguments)}};root=typeof exports!="undefined"&&exports!==null?exports:this;priceSources=["backpack.tf","spreadsheet","trade.tf"];User=function(){function n(){this.id=getCookie("steam_id");this.loggedIn=Boolean(this.id);Object.defineProperties(this,{priceSource:{get:function(){return getCookie("price_source")||priceSources[0]},set:function(n){return setCookie("price_source",n,365)}}})}return n.prototype.isOwnPage=function(){var n;return this.loggedIn&&this.id===((n=document.getElementById("steamid"))!=null?n.getAttribute("data-id"):void 0)},n}();Item=function(){function n(n){var i,r,t,u,f,e,o,s,h;for(this.elem=n,this.name=n.title,this.id=n.getAttribute("data-index"),this.imageUrl=n.getAttribute("data-image"),this.description=n.getAttribute("data-description")||"",this.level=n.getAttribute("data-level"),this.attributes=((f=n.getElementsByTagName("div"))!=null?(e=f[0])!=null?e.innerHTML:void 0:void 0)||"",this.classes=((o=n.getAttribute("data-classes"))!=null?o.split(","):void 0)||[],this.tags=((s=n.getAttribute("data-tags"))!=null?s.split(","):void 0)||[],this.storePrice=n.getAttribute("data-storeprice"),this.blueprints=n.getElementsByTagName("ul"),this.prices={},t=0,u=priceSources.length;t<u;t++)r=priceSources[t],i=JSON.parse(this.elem.getAttribute("data-"+r)),i&&(this.prices[r]=i);this.wishIndex=n.getAttribute("data-i");this.qualityNo=(h=n.className.match(/quality-(\d+)/))!=null?h[1]:void 0}return n.prototype.remove=function(){return this.elem.parentNode.removeChild(this.elem)},n}();ItemBox=function(){function n(n){this.showLink=n!=null?n:!0;this.elem=document.createElement("div");this.elem.id="itembox";document.body.appendChild(this.elem)}return n.prototype.show=function(n){var t;return this.item=new Item(n),this.sources=function(){var n,r,i;for(i=[],n=0,r=priceSources.length;n<r;n++)t=priceSources[n],t in this.item.prices&&i.push(t);return i}.call(this),this.source=user.priceSource,this._generate(),this.elem.style.display="block"},n.prototype.hide=function(){return this.elem.style.display="none"},n.prototype._nextPriceSource=function(){return this.source=this.sources[(this.sources.indexOf(this.source)+1)%this.sources.length]},n.prototype._tagsHTML=function(){var f,n,i,e,v,t,r,u,y,p,o,s,h,c,l,a;if(this.item.tags.length){for(f='<div id="tags">',v=__indexOf.call(this.item.tags,"weapon")>=0,e=__indexOf.call(this.item.tags,"token")>=0,o=["primary","secondary","melee","pda2"],r=0,y=o.length;r<y;r++)n=o[r],__indexOf.call(this.item.tags,n)>=0&&(v?(s=[""+capitalize(n)+" Weapon",n],t=s[0],i=s[1]):e&&(h=["Slot Token","slot-token"],t=h[0],i=h[1]));for(c=["hat","misc","tool","bundle"],u=0,p=c.length;u<p;u++)n=c[u],__indexOf.call(this.item.tags,n)>=0&&(l=[capitalize(n),n],t=l[0],i=l[1]);return e&&this.item.classes.length&&(a=["Class Token","class-token"],t=a[0],i=a[1]),t!=null&&i!=null&&(f+='<a href="/search?q='+encodeURIComponent(t)+'"\n target="_blank" title="'+t+'" class="'+i+'"><\/a>'),f+"<\/div>"}return""},n.prototype._nameHTML=function(){var n;return n=this.item.name,this.showLink&&(n='<a href="/item/'+this.item.id+'"\n target="_blank" class="glow" title="Go to Item Page">'+n+"<\/a>"),"<h2 id='itemname'>"+n+"<\/h2>"},n.prototype._classesHTML=function(){var i,n,t,u,r;if(this.item.classes.length){for(i='<div id="classes">',r=this.item.classes,t=0,u=r.length;t<u;t++)n=r[t],i+='<a href="/search?q='+n+'" target="_blank"\n title="'+n+'" class="'+n.toLowerCase()+'"><\/a>';return i+"<\/div>"}return""},n.prototype._bundleHTML=function(){return __indexOf.call(this.item.tags,"bundle")>=0&&this.item.description.indexOf("---")!==-1?'<a href="/search?q='+encodeURIComponent(this.item.name)+'%20Set"\n target="_blank">\n<div class="rounded glow" style="display: inline-block; padding: 7px">\nView Items\n<\/div>\n<\/a>':""},n.prototype._priceSourceHTML=function(){var e,r,u,n,f,t,i,o;if(u="",this.item.prices[this.source]||this._nextPriceSource(),this.item.prices[this.source])for(f=Object.keys(this.item.prices[this.source]).sort(),i=0,o=f.length;i<o;i++)t=f[i],n=this.item.prices[this.source][t],r=n.match(/(Refined|Key(s)?|Bud(s)?)/),r&&(e=r[0],n=n.replace(/(\d+(\.\d+)?)/g,'<a href="/search?q=$1%20'+e+'"\n target="_blank" class="glow">$1<\/a>')),u+="<span class='"+t.toLowerCase()+"'>"+t+"<\/span>: "+n+"<br>";return u},n.prototype._pricesHTML=function(){var n;return n=this._priceSourceHTML(),n?"<div id='marketprice'><span id='pricesource'>"+capitalize(this.source)+"<\/span><h3 id='prices'>"+n+"<\/h3><\/div>":""},n.prototype._blueprintsHTML=function(){var o,a,t,i,s,v,y,n,p,h,f,e,r,w,b,c,l,u;if(this.item.blueprints.length){for(t='<div id="blueprints">',c=this.item.blueprints,f=0,w=c.length;f<w;f++){for(o=c[f],a=o.getAttribute("data-chance"),t+='<div class="blueprint">',l=o.getElementsByTagName("li"),e=0,b=l.length;e<b;e++)for(i=l[e],v=r=0,u=i.getAttribute("data-count");0<=u?r<u:r>u;v=0<=u?++r:--r)n=i.title,s=i.getAttribute("data-index"),p="background-image: url("+i.getAttribute("data-image")+")",y='<div title="'+n+"\" class='item-small' style='"+p+"'><\/div>",s?h="/item/"+s:(n=n.replace("Any ","").replace("Spy Watch","PDA2 Weapon"),n.split(" ").length>2&&(n=n.replace("Weapon","Set")),h="/search?q="+encodeURIComponent(n)),t+='<a href="'+h+"\" target='_blank'>"+y+"<\/a>";t+='<div title="Crafting Chance" style="position: absolute; right: 10px">\n<h3>'+a+"%<\/h3><\/div><\/div>"}return t+"<\/div>"}return""},n.prototype._outpostHTML=function(){return'<a href="#" id="find-trades-btn"\n class="icon-exchange icon-large button-icon" title="Find Trades"><\/a>\n\n<form name="tf2outpostform" method="POST" style="display: inline-block"\n action="http://www.tf2outpost.com/search">\n\n<input type="hidden" name="json">\n<input type="hidden" name="type" value="any">\n<input type="submit" name="submit" value="Search" style="display: none">\n\n<select id="tradetype" class="textbox">\n  <option value="has1">Want<\/option>\n  <option value="wants1">Have<\/option>\n<\/select>\n\n<select id="quality" class="textbox">\n  <option value="6">Unique<\/option>\n  <option value="3">Vintage<\/option>\n  <option value="11">Strange<\/option>\n  <option value="1">Genuine<\/option>\n  <option value="13">Haunted<\/option>\n  <option value="5">Unusual<\/option>\n<\/select>\n\n<\/form>'},n.prototype._wishlistHTML=function(){return user.loggedIn?'<div style="display: inline-block; width: 40px">\n<div id="wishlistmessage"\n style="display: none; margin: 0 0 4px -18px">Added<\/div>\n<i id="wishlistbutton" class="button-icon rounded icon-star icon-large"\n style="background-color: transparent"\n title="Add to Wishlist"><\/i>\n<\/div>':""},n.prototype._buttonsHTML=function(){var n;return n="http://wiki.teamfortress.com/wiki/"+encodeURIComponent(this.item.name),'<div id="buttons">\n\n<a class="icon-info icon-large button-icon" target="_blank"\n title="Open in Wiki" href="'+n+'"><\/a>\n\n<a class="icon-shopping-cart icon-large button-icon"\n target="_blank" title="Community Market"\n href="http://steamcommunity.com/market/search?q=appid%3A440%20'+encodeURIComponent(this.item.name)+'"><\/a>\n\n<a class="icon-list icon-large button-icon" target="_blank"\n title="Backpack.tf Classifieds"\n href="http://backpack.tf/ajax/search_generate.php?defindex='+this.item.id+'&appid=440&redir=classifieds"><\/a>\n\n'+this._outpostHTML()+"\n"+this._wishlistHTML()+"\n<\/div>"},n.prototype._buyHTML=function(){return this.item.storePrice?'<div id="buy">\n<form style="display: inline-block">$'+this.item.storePrice+'<br>\n<input type="text" value="1" size="1" id="quantity"\n class="textbox" style="text-align: right">\n<\/form><a href="#" target="_blank" id="buybutton"><\/a><\/div>':""},n.prototype._pricesLink=function(){var n,i,t=this;return n=document.getElementById("pricesource"),i=document.getElementById("prices"),this.sources.length>1?(n.style.cursor="pointer",n.onclick=function(){return t._nextPriceSource(),n.innerHTML=capitalize(t.source),i.innerHTML=t._priceSourceHTML()},n.onmouseover=function(){return n.style.textShadow="0 0 10px rgb(196, 241, 128)"},n.onmouseout=function(){return n.style.textShadow=""}):void 0},n.prototype._outpostLink=function(){var n=this;return window.navigator.userAgent.indexOf("Valve Steam GameOverlay")===-1&&(this.form.target="_blank"),document.getElementById("find-trades-btn").onclick=function(){var t;return t=document.getElementById("tradetype").value,n.form.json.value='{"filters":{},"'+t+'":"440,'+n.item.id+","+n.form.quality.value+'"}',n.form.submit.click()}},n.prototype._wishlistLink=function(){var i,r,t,e,u,o,f,n=this;if(user.isOwnPage())for(f=document.getElementsByClassName("item"),t=u=0,o=f.length;u<o;t=++u)if(e=f[t],e.getAttribute("data-i")===this.item.wishIndex){this.item.wishIndex=t.toString();break}if(user.loggedIn)return i="/wishlist/add",r=document.getElementById("wishlistbutton"),user.isOwnPage()&&(i="/wishlist/remove",r.title="Remove from Wishlist"),r.onclick=function(){var t;return t={index:n.item.id,quality:n.form.quality.value},user.isOwnPage()&&(t={i:n.item.wishIndex}),postAjax(i,t,function(t){var i;return t==="Added"?(i=document.getElementById("wishlistmessage"),i.style.display="block",i.className="animated fadeInLeft",setTimeout(function(){return i.className="animated fadeOut"},1e3)):t==="Removed"?(n.hide(),n.item.remove()):void 0})}},n.prototype._buyLink=function(){var n,t,i=this;return n=document.getElementById("buybutton"),n?(t=document.getElementById("quantity"),(t.onchange=function(){return n.href="http://store.steampowered.com/buyitem/440/"+i.item.id+"/"+t.value})()):void 0},n.prototype._generate=function(){var n,t,f,i,e,r,u;if(this.elem.innerHTML=""+this._tagsHTML()+this._nameHTML()+this._classesHTML()+"\n"+this._bundleHTML()+"\n"+this._pricesHTML()+"\n"+this._blueprintsHTML()+"\n"+this._buttonsHTML()+this._buyHTML(),this.form=document.tf2outpostform,this._pricesLink(),this._outpostLink(),this._wishlistLink(),this._buyLink(),n=this.item.elem.cloneNode(!0),n.id="hoverarea",n.className="",n.setAttribute("style","background-image: url("+this.item.imageUrl+")"),this.elem.insertBefore(n,document.getElementById("blueprints")||document.getElementById("buttons")),new HoverBox(n),this.item.qualityNo)return this.form.quality.value=this.item.qualityNo;if(this.item.prices[this.source]){for(r=this.form.quality.options,u=[],t=i=0,e=r.length;i<e;t=++i)if(f=r[t],f.innerHTML in this.item.prices[this.source]){this.form.quality.selectedIndex=t;break}else u.push(void 0);return u}},n}();HoverBox=function(){function n(n,t){this.itemBox=t;this._clickItem=__bind(this._clickItem,this);this._moveMouse=__bind(this._moveMouse,this);this._hideItemBox=__bind(this._hideItemBox,this);this._hide=__bind(this._hide,this);this._show=__bind(this._show,this);n instanceof ItemBox&&(this.itemBox=n,n=null);this.elem=document.getElementById("hoverbox");this.elem||(this.elem=document.createElement("div"),this.elem.id="hoverbox",document.body.appendChild(this.elem));this._add(n)}return n.prototype._add=function(n){var t,r,i,u,f=this;for(r=n?[n]:document.getElementsByClassName("item"),i=0,u=r.length;i<u;i++)t=r[i],t.addEventListener("mouseout",this._hide,!1),t.addEventListener("mousemove",this._moveMouse,!1),t.addEventListener("mouseover",this._show,!1),this.itemBox&&t.addEventListener("click",this._clickItem,!1);if(this.itemBox)return document.addEventListener("click",this._hideItemBox,!1),document.onkeydown=function(n){if(n.keyCode===27)return f.itemBox.hide()}},n.prototype._show=function(n){var r,t,i;return i=new Item(n.target),t=escapeHTML(i.description),t&&(__indexOf.call(i.tags,"bundle")>=0&&t.indexOf("---")!==-1&&(r=t.split("---"),t=""+r[0]+'\n<span style="color: #95af0c">'+r[1]+"<\/span>"),t="<br>"+t),this.elem.innerHTML='<div style="font-size: 1.2em; color: rgb(230, 230, 230)">'+i.name+'<\/div><span style="color: gray">'+i.level+"<\/span>"+i.attributes+t,this.elem.style.display="block"},n.prototype._hide=function(){return this.elem.style.display="none"},n.prototype._hideItemBox=function(n){var t,i,r;if(t=n.target,t.className!=="item"){for(i=[];t;)i.push(t),t=t.parentNode;if(r=this.itemBox.elem,__indexOf.call(i,r)<0)return this.itemBox.hide()}},n.prototype._moveMouse=function(n){return this.elem.style.top=""+(n.pageY+28)+"px",this.elem.style.left=""+(n.pageX-154)+"px"},n.prototype._clickItem=function(n){return this.itemBox.show(n.target),n.preventDefault(),n.stopPropagation()},n}();capitalize=function(n){return n[0].toUpperCase()+n.slice(1)};escapeHTML=function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};getCookie=function(n){var t,r,i,u;for(r=document.cookie.split(";"),i=0,u=r.length;i<u;i++){for(t=r[i];t[0]===" ";)t=t.slice(1);if(t.slice(0,n.length)===n)return t.slice(n.length+1)}};setCookie=function(n,t,i){var r,u;return u="",i&&(r=new Date,r.setDate(r.getDate()+i),u=";expires="+r.toUTCString()),document.cookie=""+n+"="+t+u};ajax=function(n,t){var i;return i=_getAjaxRequest(t),i.open("GET",n,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send()};postAjax=function(n,t,i){var u,r,f;return r=_getAjaxRequest(i),r.open("POST",n,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(function(){var n=[];for(u in t)f=t[u],n.push(""+u+"="+f);return n}().join("&"))};_getAjaxRequest=function(n){var t;return t=new XMLHttpRequest,t.onreadystatechange=function(){if(t.readyState===4&&t.status===200)return n(t.responseText)},t};root.user=new User;root.ItemBox=ItemBox;root.HoverBox=HoverBox