(function(){var t,u,v,w,q,x,y,s,z,m,k=[].indexOf||function(c){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===c)return a;return-1},n=function(c,a){return function(){return c.apply(a,arguments)}};m="undefined"!==typeof exports&&null!==exports?exports:this;w=function(){return function(){var c;this.id=s("steam_id");this.isOwnPage=(this.loggedIn=Boolean(this.id))&&this.id===(null!=(c=document.getElementById("steamid"))?c.getAttribute("data-id"):void 0);this.priceSource=s("price_source")||"backpack.tf"}}();
u=function(){function c(a){var b,g,c,e;this.name=a.title;this.id=a.getAttribute("data-index");this.imageUrl=a.getAttribute("data-image");this.description=a.getAttribute("data-description")||"";this.attributes=(null!=(b=a.getElementsByTagName("div"))?null!=(g=b[0])?g.innerHTML:void 0:void 0)||"";this.classes=a.getAttribute("data-classes");this.tags=(a.getAttribute("data-tags")||"").split(",");this.storePrice=a.getAttribute("data-storeprice");this.blueprints=a.getElementsByTagName("ul");this.wishIndex=
a.getAttribute("data-i");this.qualityNo=null!=(c=a.getAttribute("class"))?null!=(e=c.match(/quality-(\d+)/))?e[1]:void 0:void 0;this.elem=a}c.prototype.marketPrice=function(a){return JSON.parse(this.elem.getAttribute("data-"+a))};c.prototype.remove=function(){return this.elem.parentNode.removeChild(this.elem)};return c}();v=function(){function c(a){null==a&&(a=!0);this.showLink=a;this.user=new w;this.elem=document.createElement("div");this.elem.id="itembox";document.getElementsByTagName("body")[0].appendChild(this.elem)}
c.prototype.show=function(a){this.item=new u(a);this.source=this.user.priceSource;this.altSource="spreadsheet"===this.source?"backpack.tf":"spreadsheet";this._generateItemBox();return this.elem.style.display="block"};c.prototype.hide=function(){return this.elem.style.display="none"};c.prototype._tagsHTML=function(){var a,b,g,c,e,f,h,l,p;if(this.item.tags.length){e="<div id='tags'>";c=0<=k.call(this.item.tags,"weapon");g=0<=k.call(this.item.tags,"token");f=b="";p=["primary","secondary","melee","pda2"];
h=0;for(l=p.length;h<l;h++)a=p[h],0<=k.call(this.item.tags,a)&&(c?(f=q(a)+" Weapon",b=a):g&&(f="Slot Token",b="slot-token"));l=["hat","misc","tool","bundle"];c=0;for(h=l.length;c<h;c++)a=l[c],0<=k.call(this.item.tags,a)&&(f=q(a),b=a);g&&this.item.classes&&(f="Class Token",b="class-token");f&&b&&(e+="<a href='/search?q="+encodeURIComponent(f)+"'\n target='_blank' title='"+f+"' class='"+b+"'></a>");return e+"</div>"}return""};c.prototype._nameHTML=function(){var a;a=this.item.name;this.showLink&&(a=
"<a href='/item/"+this.item.id+"'\n target='_blank' class='glow' title='Go to Item Page'>\n"+a+"</a>");return"<h2 id='itemname'>"+a+"</h2>"};c.prototype._classesHTML=function(){var a,b,c,d,e;if(this.item.classes){a="<div id='classes'>";e=this.item.classes.split(",");c=0;for(d=e.length;c<d;c++)b=e[c],a+="<a href='/search?q="+b+"' target='_blank'\n class='"+b.toLowerCase()+"'></a>";return a+"</div>"}return""};c.prototype._bundleHTML=function(){return 0<=k.call(this.item.tags,"bundle")&&-1!==this.item.description.indexOf("---")?
'<a href="/search?q='+encodeURIComponent(this.item.name)+"%20Set\"\n target='_blank'>\n<div class='rounded glow' style='display: inline-block; padding: 7px;'>\nView items\n</div>\n</a>":""};c.prototype._priceSourceHTML=function(a){var b,c,d,e;c="";e=this.item.marketPrice(a);for(d in e){a=e[d];if(b=a.match(/(Refined|Key(s)?|Bud(s)?)/))b=b[0],a=a.replace(/(\d+(\.\d+)?)/g,'<a href="/search?q=$1%20'+b+'"\n target="_blank" class="glow">$1</a>');c+="<span class='"+d.toLowerCase()+"'>"+d+"</span>: "+a+"<br>"}return c};
c.prototype._pricesHTML=function(){var a,b;a="http://backpack.tf/classifieds/search/"+encodeURIComponent(this.item.name);b=this._priceSourceHTML(this.source);b||(b=[this.altSource,this.source],this.source=b[0],this.altSource=b[1],b=this._priceSourceHTML(this.item,this.source));return b?'<div id="marketprice">\n<span id="pricesource">'+q(this.source)+'</span><br>\n<a href="'+a+'"\n id="classifieds" class="rounded-tight glow"\n target="_blank" style="color:rgb(129, 170, 197);display:none">\nClassifieds\n</a>\n<h3 id="prices">'+
b+"</h3></div>":""};c.prototype._blueprintsHTML=function(){var a,b,c,d,e,f,h,l,p,k,q,m,n,r;if(this.item.blueprints.length){b='<div id="blueprints">';m=this.item.blueprints;h=0;for(k=m.length;h<k;h++){a=m[h];c=a.getAttribute("data-chance");b+='<div class="blueprint">';n=a.getElementsByTagName("li");l=0;for(q=n.length;l<q;l++){a=n[l];p=0;for(r=a.getAttribute("data-count");0<=r?p<r:p>r;0<=r?++p:--p)f=a.title,d=a.getAttribute("data-index"),e="background-image:url("+a.getAttribute("data-image")+");",e=
'<div title="'+f+"\" class='item-small' style='"+e+"'></div>",d?d="/item/"+d:(f=f.replace("Any ","").replace("Spy Watch","PDA2 Weapon"),2<f.split(" ").length&&(f=f.replace("Weapon","Set")),d="/search?q="+encodeURIComponent(f)),e='<a href="'+d+"\" target='_blank'>"+e+"</a>",b+=e}b+="<div title='Crafting Chance' style='position:absolute;right:10px;'>\n<h3>"+c+"%</h3></div></div>"}return b+"</div>"}return""};c.prototype._outpostHTML=function(){return"<a href='#' id='find-trades-btn'\n class='icon-exchange icon-large button-icon' title='Find Trades'></a>\n\n<form name='tf2outpostform' method='POST' style='display:inline-block'\n action='http://www.tf2outpost.com/search'>\n\n<input type='hidden' name='json'>\n<input type='hidden' name='type' value='any'>\n<input type='submit' name='submit' value='Search' style='display:none'>\n\n<select id='tradetype' class='textbox'>\n  <option value='has1'>Want</option>\n  <option value='wants1'>Have</option>\n</select>\n\n<select id='quality' class='textbox'>\n  <option value='6'>Unique</option>\n  <option value='3'>Vintage</option>\n  <option value='11'>Strange</option>\n  <option value='1'>Genuine</option>\n  <option value='13'>Haunted</option>\n  <option value='5'>Unusual</option>\n</select>\n\n</form>"};
c.prototype._wishlistHTML=function(){return this.user.loggedIn?"<div style='display: inline-block; width: 40px'>\n<div id='wishlistmessage'\n style='display: none;margin:0 0 4px -18px'>Added</div>\n<i id='wishlistbutton' class='button-icon rounded icon-star icon-large'\n style='background-color: transparent'\n title='Add to wishlist'></i>\n</div>":""};c.prototype._buttonsHTML=function(){return"<div id='buttons'>\n\n<a class='icon-info icon-large button-icon' target='_blank'\n title='Open in Wiki' href=\"http://wiki.teamfortress.com/wiki/"+
encodeURIComponent(this.item.name)+"\"></a>\n\n<a class='icon-shopping-cart icon-large button-icon'\n target='_blank' title='Community Market'\n href=\"http://steamcommunity.com/market/search?q=appid%3A440\n%20"+encodeURIComponent(this.item.name)+'"></a>\n\n'+this._outpostHTML()+"\n"+this._wishlistHTML()+"\n</div>"};c.prototype._buyHTML=function(){return this.item.storePrice?"<div id='buy'>\n<form style='display:inline-block'>$"+this.item.storePrice+"<br>\n<input type='text' value='1' size='1' id='quantity'\n class='textbox' style='text-align: right'>\n</form><a href='#' id='buybutton'></a></div>":
""};c.prototype._pricesLink=function(){var a,b,c=this;b=document.getElementById("pricesource");if((a=document.getElementById("classifieds"))&&"backpack.tf"===this.source)a.style.display="inline";if(b&&this.item.marketPrice(this.altSource))return b.style.cursor="pointer",b.onclick=function(){c.altSource="Spreadsheet"===b.innerHTML?"backpack.tf":"spreadsheet";b.innerHTML=q(c.altSource);c.prices.innerHTML=c._priceSourceHTML(c.altSource);return"backpack.tf"===c.altSource?a.style.display="inline":a.style.display=
"none"},b.onmouseover=function(){return b.style.textShadow="0 0 10px rgb(196, 241, 128)"},b.onmouseout=function(){return b.style.textShadow=""}};c.prototype._outpostLink=function(){var a=this;-1===window.navigator.userAgent.indexOf("Valve Steam GameOverlay")&&this.form.setAttribute("target","_blank");return document.getElementById("find-trades-btn").onclick=function(b){b=document.getElementById("tradetype").value;a.form.json.value='{"filters":{},"'+b+'":"440,'+a.item.id+","+a.form.quality.value+'"}';
return a.form.submit.click()}};c.prototype._wishlistLink=function(){var a,b,c,d,e,f,h=this;if(this.user.isOwnPage){f=document.getElementsByClassName("item");a=d=0;for(e=f.length;d<e;a=++d)if(b=f[a],b.getAttribute("data-i")===this.item.wishIndex){this.item.wishIndex=a.toString();break}}if(this.user.loggedIn)return c="/wishlist/add",a=document.getElementById("wishlistbutton"),this.user.isOwnPage&&(c="/wishlist/remove",a.setAttribute("title","Remove from wishlist")),a.onclick=function(){var a;a={index:h.item.id,
quality:h.form.quality.value};h.user.isOwnPage&&(a={i:h.item.wishIndex});return z(c,a,function(a){var b;if("Added"===a)return b=document.getElementById("wishlistmessage"),b.style.display="block",b.setAttribute("class","animated fadeInLeft"),setTimeout(function(){return b.setAttribute("class","animated fadeOut")},1E3);if("Removed"===a)return h.hide(),h.item.remove()})}};c.prototype._buyLink=function(){var a,b=this;if(a=document.getElementById("buybutton"))return a.onclick=function(){var a;a=document.getElementById("quantity").value;
return window.open("http://store.steampowered.com/buyitem/440/"+b.item.id+"/"+a)}};c.prototype._generateItemBox=function(){var a,b,c,d,e,f;this.elem.innerHTML=""+this._tagsHTML()+"\n"+this._nameHTML()+"\n"+this._classesHTML()+"\n"+this._bundleHTML()+"\n"+this._pricesHTML()+"\n"+this._blueprintsHTML()+"\n"+this._buttonsHTML()+"\n"+this._buyHTML();this.form=document.tf2outpostform;this.prices=document.getElementById("prices");this._pricesLink();this._outpostLink();this._wishlistLink();this._buyLink();
a=document.createElement("div");a.title=this.item.name;a.setAttribute("data-description",this.item.description);a.setAttribute("data-tags",this.item.tags);a.id="hoverarea";a.style.backgroundImage="url('"+this.item.imageUrl+"')";b=document.getElementById("blueprints")||document.getElementById("buttons");this.elem.insertBefore(a,b);new t(a);if(-1===this.item.name.indexOf("Strange")){if(this.item.qualityNo)return this.form.quality.value=this.item.qualityNo;if(this.prices){e=this.form.quality.options;
f=[];a=c=0;for(d=e.length;c<d;a=++c)if(b=e[a],-1!==this.prices.innerHTML.indexOf(b.innerHTML)){this.form.quality.selectedIndex=a;break}else f.push(void 0);return f}}};return c}();t=function(){function c(a){this._clickItem=n(this._clickItem,this);this._moveMouse=n(this._moveMouse,this);this._hideItemBox=n(this._hideItemBox,this);this._hide=n(this._hide,this);this._show=n(this._show,this);var b;(this.itemBox=a instanceof v?a:null)||(b=a);this.elem=document.getElementById("hoverbox");this.elem||(this.elem=
document.createElement("div"),this.elem.id="hoverbox",document.getElementsByTagName("body")[0].appendChild(this.elem));this._add(b)}c.prototype._add=function(a){var b,c,d,e,f=this;c=a?[a]:document.getElementsByClassName("item");d=0;for(e=c.length;d<e;d++)b=c[d],b.addEventListener("mouseout",this._hide,!1),b.addEventListener("mousemove",this._moveMouse,!1),b.addEventListener("mouseover",this._show,!1),a||b.addEventListener("click",this._clickItem,!1);if(!a)return document.getElementById("container").addEventListener("click",
this._hideItemBox,!1),document.onkeydown=function(a){if(27===a.keyCode)return f.itemBox.hide()}};c.prototype._show=function(a){var b,c;c=a.target.title;a=new u(a.target);if(b=x(a.description))0<=k.call(a.tags,"bundle")&&-1!==b.indexOf("---")&&(b=b.split("---"),b=""+b[0]+"\n<span style='color:#95af0c'>"+b[1]+"</span>"),b="<br>"+b;this.elem.innerHTML="<div style='font-size:1.2em;color:rgb(230,230,230)'>"+c+"</div>"+a.attributes+b;return this.elem.style.display="block"};c.prototype._hide=function(){return this.elem.style.display=
"none"};c.prototype._hideItemBox=function(a){var b,c;a=a.target;if("item"!==a.getAttribute("class")){for(b=[];a;)b.push(a),a=a.parentNode;if(c=this.itemBox.elem,0>k.call(b,c))return this.itemBox.hide()}};c.prototype._moveMouse=function(a){this.elem.style.top=""+(a.pageY+28)+"px";return this.elem.style.left=""+(a.pageX-154)+"px"};c.prototype._clickItem=function(a){this.itemBox.show(a.target);a.preventDefault();return a.stopPropagation()};return c}();q=function(c){return c[0].toUpperCase()+c.slice(1)};
x=function(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};s=function(c){var a,b,g,d;b=document.cookie.split(";");g=0;for(d=b.length;g<d;g++){for(a=b[g];" "===a[0];)a=a.slice(1);if(a.slice(0,c.length)===c)return a.slice(c.length+1)}};z=function(c,a,b){var g,d;b=y(b);b.open("POST",c,!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c=[];for(g in a)d=a[g],c.push(""+g+"="+d);return b.send(c.join("&"))};y=function(c){var a;try{a=new XMLHttpRequest}catch(b){try{a=
new ActiveXObject("Msxml2.XMLHTTP")}catch(g){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(d){return null}}}a.onreadystatechange=function(){if(4===a.readyState)return c(a.responseText)};return a};m.ItemBox=v;m.HoverBox=t;m.getCookie=s;m.setCookie=function(c,a,b){var g;g="";b&&(g=new Date,g.setDate(g.getDate()+b),g=";expires="+g.toUTCString());return document.cookie=""+c+"="+a+g}}).call(this);
