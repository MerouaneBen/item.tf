(function(){var HoverBox,Item,ItemBox,User,_getAjaxRequest,ajax,capitalize,escapeHTML,getCookie,postAjax,priceSources,root,setCookie,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},bind=function(fn,me){return function(){return fn.apply(me,arguments)}};root=typeof exports!=="undefined"&&exports!==null?exports:this;priceSources=["backpack.tf","trade.tf"];User=function(){function User(){this.id=getCookie("steam_id");this.loggedIn=Boolean(this.id);Object.defineProperties(this,{priceSource:{get:function(){return getCookie("price_source")||priceSources[0]},set:function(source){return setCookie("price_source",source,365)}}})}User.prototype.isOwnPage=function(){var ref;return this.loggedIn&&this.id===((ref=document.getElementById("steamid"))!=null?ref.getAttribute("data-id"):void 0)};return User}();Item=function(){function Item(elem1){var j,len,price,ref,ref1,ref2,ref3,ref4,ref5,ref6,source;this.elem=elem1;this.name=this.elem.title;this.id=this.elem.getAttribute("data-index");this.imageUrl=this.elem.getAttribute("data-image");this.description=this.elem.getAttribute("data-description")||"";this.level=this.elem.getAttribute("data-level");this.attributes=((ref=this.elem.getElementsByTagName("div"))!=null?(ref1=ref[0])!=null?ref1.innerHTML:void 0:void 0)||"";this.classes=((ref2=this.elem.getAttribute("data-classes"))!=null?ref2.split(","):void 0)||[];this.tags=((ref3=this.elem.getAttribute("data-tags"))!=null?ref3.split(","):void 0)||[];this.storePrice=this.elem.getAttribute("data-storeprice");this.blueprints=this.elem.getElementsByTagName("ul");this.prices={};for(j=0,len=priceSources.length;j<len;j++){source=priceSources[j];price=JSON.parse((ref4=(ref5=this.elem.getAttribute("data-"+source))!=null?ref5.replace('Collector"s',"Collector's"):void 0)!=null?ref4:null);if(price){this.prices[source]=price}}this.wishIndex=this.elem.getAttribute("data-i");this.qualityNo=(ref6=this.elem.className.match(/quality-(\d+)/))!=null?ref6[1]:void 0}Item.prototype.remove=function(){return this.elem.parentNode.removeChild(this.elem)};return Item}();ItemBox=function(){function ItemBox(showLink){this.showLink=showLink!=null?showLink:true;this.elem=document.createElement("div");this.elem.id="itembox";document.body.appendChild(this.elem)}ItemBox.prototype.show=function(elem){var source;this.item=new Item(elem);this.sources=function(){var j,len,results;results=[];for(j=0,len=priceSources.length;j<len;j++){source=priceSources[j];if(source in this.item.prices){results.push(source)}}return results}.call(this);this.source=user.priceSource;this._generate();return this.elem.style.display="block"};ItemBox.prototype.hide=function(){return this.elem.style.display="none"};ItemBox.prototype._nextPriceSource=function(){return this.source=this.sources[(this.sources.indexOf(this.source)+1)%this.sources.length]};ItemBox.prototype._tagsHTML=function(){var html,i,image,isToken,isWeapon,j,k,len,len1,ref,ref1,ref2,ref3,ref4,ref5,title;if(this.item.tags.length){html='<div id="tags">';isWeapon=indexOf.call(this.item.tags,"weapon")>=0;isToken=indexOf.call(this.item.tags,"token")>=0;ref=["primary","secondary","melee","pda2"];for(j=0,len=ref.length;j<len;j++){i=ref[j];if(indexOf.call(this.item.tags,i)>=0){if(isWeapon){ref1=[capitalize(i)+" Weapon",i],title=ref1[0],image=ref1[1]}else if(isToken){ref2=["Slot Token","slot-token"],title=ref2[0],image=ref2[1]}}}ref3=["hat","misc","tool","bundle"];for(k=0,len1=ref3.length;k<len1;k++){i=ref3[k];if(indexOf.call(this.item.tags,i)>=0){ref4=[capitalize(i),i],title=ref4[0],image=ref4[1]}}if(isToken&&this.item.classes.length){ref5=["Class Token","class-token"],title=ref5[0],image=ref5[1]}if(title!=null&&image!=null){html+='<a href="/search?q='+encodeURIComponent(title)+'"\n target="_blank" title="'+title+'" class="'+image+'"></a>'}return html+="</div>"}else{return""}};ItemBox.prototype._nameHTML=function(){var html;html=this.item.name;if(this.showLink){html='<a href="/'+this.item.id+'"\n target="_blank" class="glow" title="Go to Item Page">'+html+"</a>"}return html='<h2 id="itemname">'+html+'</h2>\n<i id="shortlinkbutton" class="fa fa-caret-square-o-down"\n title="Short URL"></i><br>\n<div id="shortlink" style="display:none">\n<input type="text" value="http://item.tf/'+this.item.id+'" readonly><br></div>'};ItemBox.prototype._classesHTML=function(){var class_,html,j,len,ref;if(this.item.classes.length){html='<div id="classes">';ref=this.item.classes;for(j=0,len=ref.length;j<len;j++){class_=ref[j];html+='<a href="/search?q='+class_+'" target="_blank"\n title="'+class_+'" class="'+class_.toLowerCase()+'"></a>'}return html+="</div>"}else{return""}};ItemBox.prototype._bundleHTML=function(){if(indexOf.call(this.item.tags,"bundle")>=0&&this.item.description.indexOf("---")!==-1){return'<a href="/search?q='+encodeURIComponent(this.item.name)+'%20Set"\n target="_blank">\n<div class="rounded glow" style="display: inline-block; padding: 7px">\nView Items\n</div>\n</a>'}else{return""}};ItemBox.prototype._priceSourceHTML=function(){var denom,denomMatch,html,j,len,price,qualities,quality;html="";if(!this.item.prices[this.source]){this._nextPriceSource()}if(this.item.prices[this.source]){qualities=Object.keys(this.item.prices[this.source]).sort();for(j=0,len=qualities.length;j<len;j++){quality=qualities[j];price=this.item.prices[this.source][quality];denomMatch=price.match(/(Refined|Key(s)?|Bud(s)?)/);if(denomMatch){denom=denomMatch[0];price=price.replace(/(\d+(\.\d+)?)/g,"<a href='/search?q=$1%20"+denom+"' target='_blank' class='glow'>$1</a>")}html+='<a href="/search?q='+quality+'" target="_blank"\n class="'+quality.toLowerCase().replace("'","")+'">'+quality+": "+price+"</a><br>"}}return html};ItemBox.prototype._pricesHTML=function(){var html;html=this._priceSourceHTML();if(html){return"<div id='marketprice'><span id='pricesource'>"+capitalize(this.source)+"</span><h3 id='prices'>"+html+"</h3></div>"}else{return""}};ItemBox.prototype._blueprintsHTML=function(){var blueprint,chance,html,i,index,item,j,k,l,len,len1,listItem,name,ref,ref1,ref2,style,url;if(this.item.blueprints.length){html='<div id="blueprints">';ref=this.item.blueprints;for(j=0,len=ref.length;j<len;j++){blueprint=ref[j];chance=blueprint.getAttribute("data-chance");html+='<div class="blueprint">';ref1=blueprint.getElementsByTagName("li");for(k=0,len1=ref1.length;k<len1;k++){item=ref1[k];for(i=l=0,ref2=item.getAttribute("data-count");0<=ref2?l<ref2:l>ref2;i=0<=ref2?++l:--l){name=item.title;index=item.getAttribute("data-index");style="background-image: url("+item.getAttribute("data-image")+")";listItem='<div title="'+name+"\" class='item-small' style='"+style+"'></div>";if(index){url="/"+index}else{name=name.replace("Any ","").replace("Spy Watch","PDA2 Weapon");if(name.split(" ").length>2){name=name.replace("Weapon","Set")}url="/search?q="+encodeURIComponent(name)}html+='<a href="'+url+"\" target='_blank'>"+listItem+"</a>"}}html+='<div title="Crafting Chance" style="position: absolute; right: 10px">\n<h3>'+chance+"%</h3></div></div>"}return html+="</div>"}else{return""}};ItemBox.prototype._outpostHTML=function(){return'<a href="#" id="find-trades-btn"\n class="fa fa-exchange fa-lg button-icon" title="Find Trades"></a>\n\n<form name="tf2outpostform" method="POST" style="display: inline-block"\n action="http://www.tf2outpost.com/search">\n\n<input type="hidden" name="json">\n<input type="submit" name="submit" value="Search!" style="display: none">\n\n<select id="tradetype" class="textbox">\n  <option value="has1">Want</option>\n  <option value="wants1">Have</option>\n</select>\n\n<select id="quality" class="textbox">\n  <option value="6">Unique</option>\n  <option value="3">Vintage</option>\n  <option value="11">Strange</option>\n  <option value="1">Genuine</option>\n  <option value="14">Collector\'s</option>\n  <option value="13">Haunted</option>\n  <option value="5">Unusual</option>\n</select>\n\n</form>'};ItemBox.prototype._wishlistHTML=function(){if(user.loggedIn){return'<div style="display: inline-block; width: 40px">\n<div id="wishlistmessage"\n style="display: none; margin: 0 0 4px -18px">Added</div>\n<i id="wishlistbutton" class="fa fa-star fa-lg button-icon"\n title="Add to Wishlist"></i>\n</div>'}else{return""}};ItemBox.prototype._buttonsHTML=function(){var wikiLink;wikiLink="http://wiki.teamfortress.com/wiki/"+encodeURIComponent(this.item.name);return'<div id="buttons">\n\n<a class="fa fa-info fa-lg button-icon" target="_blank"\n title="Open in Wiki" href="'+wikiLink+'"></a>\n\n<a id="market-btn" class="fa fa-shopping-cart fa-lg button-icon"\n target="_blank" title="Community Market"></a>\n\n<a id="classifieds-btn" class="fa fa-list fa-lg button-icon"\n target="_blank" title="Backpack.tf Classifieds"></a>\n\n'+this._outpostHTML()+"\n"+this._wishlistHTML()+"\n</div>"};ItemBox.prototype._buyHTML=function(){if(this.item.storePrice){return'<div id="buy">\n<form style="display: inline-block">$'+this.item.storePrice+'<br>\n<input type="text" value="1" size="1" id="quantity"\n class="textbox" style="text-align: right">\n</form><a href="#" target="_blank" id="buybutton"></a></div>'}else{return""}};ItemBox.prototype._nameLink=function(){var link,linkButton;linkButton=document.getElementById("shortlinkbutton");link=document.getElementById("shortlink");return linkButton.onclick=function(){if(link.style.display==="none"){link.style.display="inline";linkButton.className=linkButton.className.replace("down","up");return link.getElementsByTagName("input")[0].select()}else{link.style.display="none";return linkButton.className=linkButton.className.replace("up","down")}}};ItemBox.prototype._pricesLink=function(){var button,prices;button=document.getElementById("pricesource");prices=document.getElementById("prices");if(this.sources.length>1){button.style.cursor="pointer";button.onclick=function(_this){return function(){_this._nextPriceSource();button.innerHTML=capitalize(_this.source);return prices.innerHTML=_this._priceSourceHTML()}}(this);button.onmouseover=function(){return button.style.textShadow="0 0 10px rgb(196, 241, 128)"};return button.onmouseout=function(){return button.style.textShadow=""}}};ItemBox.prototype._buttonsLink=function(){return(this.form.quality.onchange=function(_this){return function(){var classifieds,market,quality;market=document.getElementById("market-btn");quality=_this.form.quality.options[_this.form.quality.selectedIndex].text.toLowerCase().replace("unique","Unique").replace("genuine","rarity1").replace("unusual","rarity4").replace("collector's","collectors");market.href="http://steamcommunity.com/market/search?category_440_Type%5B%5D=any&category_440_Quality%5B%5D=tag_"+quality+"&appid=440&q="+encodeURIComponent(_this.item.name);classifieds=document.getElementById("classifieds-btn");return classifieds.href="http://backpack.tf/classifieds?item="+encodeURIComponent(_this.item.name)+"&quality="+_this.form.quality.value}}(this))()};ItemBox.prototype._outpostLink=function(){if(window.navigator.userAgent.indexOf("Valve Steam GameOverlay")===-1){this.form.target="_blank"}return document.getElementById("find-trades-btn").onclick=function(_this){return function(event){var tradeType;tradeType=document.getElementById("tradetype").value;_this.form.json.value='{"attributes":{},"match_all":false,"'+tradeType+'":"440,'+_this.item.id+","+_this.form.quality.value+'"}';return _this.form.submit.click()}}(this)};ItemBox.prototype._wishlistLink=function(){var action,button,idx,j,len,ref,wish;if(user.isOwnPage()){ref=document.getElementsByClassName("item");for(idx=j=0,len=ref.length;j<len;idx=++j){wish=ref[idx];if(wish.getAttribute("data-i")===this.item.wishIndex){this.item.wishIndex=idx.toString();break}}}if(user.loggedIn){action="/wishlist/add";button=document.getElementById("wishlistbutton");if(user.isOwnPage()){action="/wishlist/remove";button.title="Remove from Wishlist"}return button.onclick=function(_this){return function(){var data;data={index:_this.item.id,quality:_this.form.quality.value};if(user.isOwnPage()){data={i:_this.item.wishIndex}}return postAjax(action,data,function(response){var message;if(response==="Added"){message=document.getElementById("wishlistmessage");message.style.display="block";message.className="animated fadeInLeft";return setTimeout(function(){return message.className="animated fadeOut"},1e3)}else if(response==="Removed"){_this.hide();return _this.item.remove()}})}}(this)}};ItemBox.prototype._buyLink=function(){var button,quantity;button=document.getElementById("buybutton");if(button){quantity=document.getElementById("quantity");return(quantity.onchange=function(_this){return function(){return button.href="http://store.steampowered.com/buyitem/440/"+_this.item.id+"/"+quantity.value}}(this))()}};ItemBox.prototype._generate=function(){var hoverArea,i,j,len,option,ref,results;this.elem.innerHTML=""+this._tagsHTML()+this._nameHTML()+this._classesHTML()+"\n"+this._bundleHTML()+"\n"+this._pricesHTML()+"\n"+this._blueprintsHTML()+"\n"+this._buttonsHTML()+this._buyHTML();this.form=document.tf2outpostform;this._nameLink();this._pricesLink();this._buttonsLink();this._outpostLink();this._wishlistLink();this._buyLink();hoverArea=this.item.elem.cloneNode(true);hoverArea.id="hoverarea";hoverArea.className="";hoverArea.setAttribute("style","background-image: url("+this.item.imageUrl+")");this.elem.insertBefore(hoverArea,document.getElementById("blueprints")||document.getElementById("buttons"));new HoverBox(hoverArea);if(this.item.qualityNo){return this.form.quality.value=this.item.qualityNo}else if(this.item.prices[this.source]){ref=this.form.quality.options;results=[];for(i=j=0,len=ref.length;j<len;i=++j){option=ref[i];if(option.innerHTML in this.item.prices[this.source]){this.form.quality.selectedIndex=i;this.form.quality.onchange();break}else{results.push(void 0)}}return results}};return ItemBox}();HoverBox=function(){function HoverBox(area,itemBox){this.itemBox=itemBox;this._clickItem=bind(this._clickItem,this);this._moveMouse=bind(this._moveMouse,this);this._hideItemBox=bind(this._hideItemBox,this);this._hide=bind(this._hide,this);this._show=bind(this._show,this);if(area instanceof ItemBox){this.itemBox=area;area=null}this.elem=document.getElementById("hoverbox");if(!this.elem){this.elem=document.createElement("div");this.elem.id="hoverbox";document.body.appendChild(this.elem)}this._add(area)}HoverBox.prototype._add=function(area){var event,item,j,k,len,len1,list,ref;list=area?[area]:document.getElementsByClassName("item");for(j=0,len=list.length;j<len;j++){item=list[j];item.addEventListener("mouseout",this._hide,false);item.addEventListener("mousemove",this._moveMouse,false);item.addEventListener("mouseover",this._show,false);if(this.itemBox){item.addEventListener("click",this._clickItem,false)}}if(this.itemBox){ref=["click","touchend"];for(k=0,len1=ref.length;k<len1;k++){event=ref[k];document.addEventListener(event,this._hideItemBox,false)}return document.onkeydown=function(_this){return function(e){if(e.keyCode===27){return _this.itemBox.hide()}}}(this)}};HoverBox.prototype._show=function(e){var descList,description,item;item=new Item(e.target);description=escapeHTML(item.description);if(description){if(indexOf.call(item.tags,"bundle")>=0&&description.indexOf("---")!==-1){descList=description.split("---");description=descList[0]+'\n<span style="color: #95af0c">'+descList[1]+"</span>"}description="<br>"+description}this.elem.innerHTML='<div style="font-size: 1.2em; color: rgb(230, 230, 230)">'+item.name+'</div><span style="color: gray">'+item.level+"</span>"+item.attributes+description;return this.elem.style.display="block"};HoverBox.prototype._hide=function(){return this.elem.style.display="none"};HoverBox.prototype._hideItemBox=function(e){var el,els,ref;el=e.target;if(el.className!=="item"){els=[];while(el){els.push(el);el=el.parentNode}if(ref=this.itemBox.elem,indexOf.call(els,ref)<0){return this.itemBox.hide()}}};HoverBox.prototype._moveMouse=function(e){this.elem.style.top=e.pageY+28+"px";return this.elem.style.left=e.pageX-154+"px"};HoverBox.prototype._clickItem=function(e){this.itemBox.show(e.target);e.preventDefault();return e.stopPropagation()};return HoverBox}();capitalize=function(word){return word[0].toUpperCase()+word.slice(1)};escapeHTML=function(string){return string.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};getCookie=function(name){var cookie,cookies,j,len;cookies=document.cookie.split(";");for(j=0,len=cookies.length;j<len;j++){cookie=cookies[j];while(cookie[0]===" "){cookie=cookie.slice(1)}if(cookie.slice(0,name.length)===name){return cookie.slice(name.length+1)}}};setCookie=function(name,value,days){var date,expires;expires="";if(days){date=new Date;date.setDate(date.getDate()+days);expires=";expires="+date.toUTCString()}return document.cookie=name+"="+value+expires};ajax=function(url,callback){var request;request=_getAjaxRequest(callback);request.open("GET",url,true);request.setRequestHeader("X-Requested-With","XMLHttpRequest");return request.send()};postAjax=function(url,data,callback){var name,request,value;request=_getAjaxRequest(callback);request.open("POST",url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");return request.send(function(){var results;results=[];for(name in data){value=data[name];results.push(name+"="+value)}return results}().join("&"))};_getAjaxRequest=function(callback){var request;request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){return callback(request.responseText)}};return request};root.user=new User;root.ItemBox=ItemBox;root.HoverBox=HoverBox}).call(this);
//# sourceMappingURL=main.js.map