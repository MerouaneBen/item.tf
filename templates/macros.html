{% macro showitem(item, visible=True) %}
{% set style = 'background-image: url("{}");'.format(item['image']) %}
{% if not visible %}{% set style = style + 'display: none' %}{% endif %}
<a href="/{{item['index']}}">
<div class="item{% if 'quality' in item %} quality-{{item['quality']}}{% endif %}" title="{{item['name']}}" style="{{style}}" data-index="{{item['index']}}" data-image="{{item['image_large']}}" data-level="{{item['level']}}"{% for i in ['classes','tags'] %}{% if item[i] %} data-{{i}}="{{item[i]|join(',')}}"{% endif %}{% endfor %}{% for i in ['storeprice','description'] %}{% if item[i] %} data-{{i}}="{{item[i]}}"{% endif %}{% endfor %}{% for i in item['marketprice'] %}{% if item['marketprice'][i] %} data-{{i}}="{{item['marketprice'][i]|replace("'", '"')}}"{% endif %}{% endfor %}{% if 'i' in item %} data-i="{{item['i']}}"{% endif %}>
{%- for b in item['blueprints'] %}
<ul data-chance="{{b['chance']}}" style="display:none">
  {%- for i in b['required'] %}
  <li title="{{i['name']}}"{% if i['index'] %} data-index="{{i['index']}}"{% endif %} data-image="{{i['image']}}" data-count="{{i['count']}}"></li>
  {%- endfor %}
</ul>
{%- endfor %}

<div style="display: none">
{% for a in item['attributes'] %}
<span class="{{a['type']}}">{{a['description']}}</span>
{% endfor %}
</div>
</div>
</a>
{% endmacro %}

{% macro getcount(length, unit) %}
{{length}} {{unit}}{% if length != 1 %}s{% endif %}
{% endmacro %}

{% macro showitems(items, columns=10) %}
<div class="itemlist" style="width:{{columns * 108}}px">
{% if columns == 10 %}
<div style="color: gray; padding-bottom: 20px">{{getcount(items | length, 'item')}}</div>
{% endif %}
{% for item in items %}
{{showitem(item)}}
{%- endfor %}
</div>
{% endmacro %}

{% macro showsearchlinks(stringlist) %}
{% for string in stringlist %}
<a href="/search?q={{string|replace(' ','%20')}}">{{string}}</a><br>
{% endfor %}
{% endmacro %}
